<dom-module id="peggy-list">
  <template>
    <template is="dom-repeat" items="{{cart}}">
      <div>
        <span>[[item.amount]]</span>
        <span>[[item.selected.tag]]</span>
        <span>[[item.selected.price]]</span>
        <span>[[item.subtotal]]</span>
        <paper-icon-button on-tap="_delete" icon=delete></paper-icon-button>
      </div>
    </template>
  </template>
  <script>
  Polymer({
    is: 'peggy-list',
    properties: {
      cart: {
        type: Array,
        notify: true,
      },
      total: {
        type: Number,
        notify: true,
        value: 0
      }
    },

    observers: ['_calcSubtotal(cart.*)'],

    _cartChanged: function(cart) {
      if(cart.path.split('.')[2] == 'subtotal')
        this._calcSubtotal();
    },

    _calcSubtotal: function() {
      if(!this.cart)
       return;

      this.set('total', this.cart.reduce((a, b) => {
        return a + b.subtotal;
      }, 0));
    },

    _delete: function(e) {
      this.fire('delete', {index: e.model.index});
    },
    // _addOption: function(e) {
    //   e.model.item.addOption({tag: this.$.tag.value, price: this.$.price.value});
    //   this.notifyPath(`cart.${e.model.index}.options`);
    // },
    // _next: function(e) {
    //   e.model.item.next();
    //   this.notifyPath(`cart.${e.model.index}.selected`);
    //   this.notifyPath(`cart.${e.model.index}.subtotal`);
    // },
    //
    // _back: function(e) {
    //   e.model.item.back();
    //   this.notifyPath(`cart.${e.model.index}.selected`);
    //   this.notifyPath(`cart.${e.model.index}.subtotal`);
    // },

  });
  </script>
</dom-module>
